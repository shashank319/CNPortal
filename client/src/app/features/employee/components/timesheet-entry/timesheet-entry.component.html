<div class="timesheet-entry-container">
  <!-- Header -->
  <div class="header">
    <h1>Timesheet Entry</h1>
    <div class="user-info">
      <span class="total-hours">Total Hours: {{ totalHours }}</span>
    </div>
  </div>

  <!-- Form Controls -->
  <form [formGroup]="timesheetForm" class="timesheet-form">
    <mat-card class="controls-card">
      <mat-card-content>
        <div class="form-row">
          <mat-form-field appearance="outline" class="period-field">
            <mat-label>Time Period</mat-label>
            <mat-select formControlName="periodType">
              <mat-option *ngFor="let period of periodTypes" [value]="period.value">
                {{ period.label }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" class="year-field">
            <mat-label>Year</mat-label>
            <mat-select formControlName="year">
              <mat-option *ngFor="let year of years" [value]="year.value">
                {{ year.label }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" class="month-field">
            <mat-label>Month</mat-label>
            <mat-select formControlName="month">
              <mat-option *ngFor="let month of months" [value]="month.value">
                {{ month.label }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <div class="employee-info">
            <span class="employee-label">Employee:</span>
            <span class="employee-name">{{ selectedEmployee }}</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Calendar Grid -->
    <mat-card class="calendar-card" *ngIf="!isLoading">
      <mat-card-content>
        <div class="calendar-grid"
             [class.weekly-view]="timesheetForm.get('periodType')?.value === 1"
             [class.biweekly-view]="timesheetForm.get('periodType')?.value === 2"
             [class.monthly-view]="timesheetForm.get('periodType')?.value === 3">

          <!-- Weekly View -->
          <div *ngIf="timesheetForm.get('periodType')?.value === 1" class="week-row">
            <div *ngFor="let day of calendarDays; let i = index" [class]="getDayClass(day)">
              <div class="day-header">
                <span class="day-name">{{ day.dayName }}</span>
                <span class="day-number">{{ day.dayNumber }}</span>
              </div>
              <mat-form-field appearance="outline" class="hours-field">
                <input
                  matInput
                  type="number"
                  min="0"
                  max="24"
                  step="0.5"
                  [formControl]="getHoursControl(i)"
                  (input)="onHoursChange(i, $event)"
                  [class]="getHoursInputClass(day, i)"
                  placeholder="0">
              </mat-form-field>
            </div>
          </div>

          <!-- Bi-Weekly View -->
          <div *ngIf="timesheetForm.get('periodType')?.value === 2" class="biweekly-container">
            <div class="week-section" *ngFor="let weekDays of getBiWeeklyWeeks(); let weekIndex = index">
              <h3 class="week-title">Week {{ weekIndex + 1 }}</h3>
              <div class="week-row">
                <div *ngFor="let day of weekDays; let i = index" [class]="getDayClass(day)">
                  <div class="day-header">
                    <span class="day-name">{{ day.dayName }}</span>
                    <span class="day-number">{{ day.dayNumber }}</span>
                  </div>
                  <mat-form-field appearance="outline" class="hours-field">
                    <input
                      matInput
                      type="number"
                      min="0"
                      max="24"
                      step="0.5"
                      [formControl]="getHoursControl(weekIndex * 7 + i)"
                      (input)="onHoursChange(weekIndex * 7 + i, $event)"
                      [class]="getHoursInputClass(day, weekIndex * 7 + i)"
                      placeholder="0">
                  </mat-form-field>
                </div>
              </div>
            </div>
          </div>

          <!-- Monthly View -->
          <div *ngIf="timesheetForm.get('periodType')?.value === 3" class="monthly-container">
            <div class="month-grid">
              <!-- Days of week header -->
              <div class="day-header-row">
                <div class="day-header-cell">Sun</div>
                <div class="day-header-cell">Mon</div>
                <div class="day-header-cell">Tue</div>
                <div class="day-header-cell">Wed</div>
                <div class="day-header-cell">Thu</div>
                <div class="day-header-cell">Fri</div>
                <div class="day-header-cell">Sat</div>
              </div>

              <!-- Calendar cells -->
              <div class="calendar-row" *ngFor="let week of getMonthlyWeeks()">
                <div *ngFor="let day of week; let i = index" [class]="getDayClass(day)">
                  <div class="day-header">
                    <span class="day-number">{{ day.dayNumber }}</span>
                  </div>
                  <mat-form-field appearance="outline" class="hours-field" *ngIf="day.isCurrentMonth && getDayIndex(day) >= 0">
                    <input
                      matInput
                      type="number"
                      min="0"
                      max="24"
                      step="0.5"
                      [formControl]="getHoursControl(getDayIndex(day))"
                      (input)="onHoursChange(getDayIndex(day), $event)"
                      [class]="getHoursInputClass(day, getDayIndex(day))"
                      placeholder="0">
                  </mat-form-field>
                </div>
              </div>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Loading Spinner -->
    <div *ngIf="isLoading" class="loading-container">
      <mat-spinner></mat-spinner>
      <p>Loading timesheet...</p>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons" *ngIf="!isLoading">
      <div class="left-actions">
        <button
          type="button"
          mat-stroked-button
          (click)="autoFill8Hours()"
          [disabled]="isSaving"
          matTooltip="Fill 8 hours for all weekdays">
          <mat-icon>auto_fix_high</mat-icon>
          Auto-Fill 8h/day
        </button>

        <button
          type="button"
          mat-stroked-button
          (click)="clearAll()"
          [disabled]="isSaving"
          matTooltip="Clear all entered hours">
          <mat-icon>clear_all</mat-icon>
          Clear All
        </button>
      </div>

      <div class="right-actions">
        <button
          type="button"
          mat-stroked-button
          (click)="saveDraft()"
          [disabled]="isSaving || timesheetForm.invalid">
          <mat-icon>save</mat-icon>
          Save Draft
        </button>

        <button
          type="button"
          mat-raised-button
          color="primary"
          (click)="submitTimesheet()"
          [disabled]="isSaving || timesheetForm.invalid || totalHours === 0">
          <mat-icon>send</mat-icon>
          Submit Timesheet
        </button>
      </div>
    </div>

    <!-- Status Indicator -->
    <div *ngIf="currentTimesheet" class="status-indicator">
      <mat-chip-set>
        <mat-chip [class]="'status-' + currentTimesheet.status">
          {{ getStatusLabel(currentTimesheet.status) }}
        </mat-chip>
      </mat-chip-set>
    </div>
  </form>
</div>